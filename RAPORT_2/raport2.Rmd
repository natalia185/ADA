---
title: "Raport 2"
author: "Natalia Iwańska 262270, Klaudia Janicka 262268"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message=FALSE)
knitr::opts_chunk$set(fig.width=8, fig.height=4.5) 
pdf.options(encoding = 'CP1250')
```

```{r, include=FALSE, echo=FALSE}
library("tidyverse")
library("vcd")
library("ggplot2")
library("knitr")
library("dplyr")
library("xtable")
library("kableExtra")
library("ggplot2")
library('likert')
library("binom")
```

```{r, include=FALSE, echo=FALSE}
personel <- read.csv2('personel.csv',header=FALSE)
names(personel) <- c('D','S','A1','A2','W1','W2','P','Wiek','Wyk')
personel$A2[personel$A2 == '11'] = '1'
personel <- personel %>% mutate(across(D:Wyk,as.factor))
```

# Zadanie 2

$H_0 \colon$ Płeć i zajmowane stanowisko nie zależą od siebie.


```{r, echo=FALSE}
t2 <- structable(P~S,personel) %>% addmargins()
t1 <- ftable(personel$P,personel$S)
test2 <- fisher.test(t1)
```

```{=latex}
\begin{table}[ht]
\centering
\begin{tabular}{|c|c|c|c|}
  \hline
 & K & M \\ 
  \hline
nie & 63.00 & 110.00 \\ 
\hline
  tak & 8.00 & 19.00 \\ 
   \hline
\end{tabular}
\end{table}
```

Korzystamy z testu Fishera.

```{r}
test2$p.value
```

**Wnioski**

Na zadanym poziomie istotności, $\alpha = 0.05$, wyliczona p-wartość sugeruje, że nie mamy podstaw do odrzucenia hipotezy zerowej. 


# Zadanie 3

$H_0 \colon$ Zajmowanie stanowiska kierowniczego nie zależy od wieku.

Korzystamy z testu Fishera. 

```{r}
t3a <- ftable(personel,col.vars='S',row.vars='Wiek')
fisher.test(t3a)
```

$H_0 \colon$ Zajmowanie stanowiska kierowniczego nie zależy od wykształcenia.

```{r}
t3b <- ftable(personel,col.vars='S',row.vars='Wyk')
fisher.test(t3b)
```

**Wnioski**

w pierwszym przeprowadzonym teście wyliczona p-wartość sugeruje, że nie ma podstaw do odrzucenia hipotezy zerowej, iż zajmowanie stanowiska kierowniczego nie zależy od wieku. Natomiast w 2. przypadku odrzucamy hipotezę zerową - zajmowanie stanowiska kierowniczego nie zależy od wykształcenia.


# zadanie 4

$H_0 \colon$ Zadowolenie z wynagrodzenia ( w pierwszym badanym okresie) nie zależy od zajmowanego stanowiska.

```{r}
t4a <- ftable(personel,col.vars='W1',row.vars='S')
fisher.test(t4a)
```

$H_0 \colon$ Zadowolenie z wynagrodzenia (w pierwszym badanym okresie) nie zależy od wykształcenia.

```{r}
t4b <- ftable(personel,col.vars='W1',row.vars='Wyk')
fisher.test(t4b)
```

$H_0 \colon$ Zadowolenie z wynagrodzenia(w pierwszym badanym okresie) nie zależy od płci.

```{r}
t4c <- ftable(personel,col.vars='W1',row.vars='P')
fisher.test(t4c)
```

$H_0 \colon$ Zadowolenie z wynagrodzenia (w pierwszym badanym okresie) nie zależy od wieku. 

```{r}
t4d <- ftable(personel,col.vars='W1',row.vars='Wiek')
fisher.test(t4d, workspace = 271020)
```

**Wnioski**


# Zadanie 7

```{r}
size_simulation <- function(alpha=0.05, M=5000){
  ns <- c(50, 100, 1000)
  p <- c(1/20, 9/20, 1/20, 9/20)
  fisher <- rep(NA, 3)
  chisq <- rep(NA, 3)
  ratio <- rep(NA, 3)
  for(i in 1:length(ns)){
    n <- ns[i]
    count_f <- 0
    count_c <- 0
    count_r <- 0
    for(m in 1:M){
      tab <- matrix(rmultinom(1, n, p), nrow=2)
      while(0 %in% tab){
        tab <- matrix(rmultinom(1, n, p), nrow=2)
      }
      if(fisher.test(tab, conf.level = 1-alpha)$p.value < alpha){
        count_f <- count_f + 1
      }
      if(chisq.test(tab)$p.value < alpha){
        count_c <- count_c + 1
      }
      if(assocstats(tab)$chisq_tests[,3][1] < alpha){
        count_r <- count_r + 1
      }
    }
    fisher[i] <- count_f/M
    chisq[i] <- count_c/M
    ratio[i] <- count_r/M
  }
  return(data.frame('n' = ns, 'fisher' = fisher,'chisq' = chisq, 'likelihood_ratio' = ratio))
}
```

```{r}
size_simulation() %>% kable
```

