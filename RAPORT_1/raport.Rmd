---
title: "Analiza danych ankietowych"
subtitle: "Raport 1"
author: "Klaudia Janicka 262268, Natalia Iwańska 262270"
date: "`r Sys.Date()`"
output: pdf_document
header-includes:
  \usepackage{booktabs}
  \usepackage{float}
  \renewcommand{\tablename}{Tab.}
  \renewcommand{\figurename}{Wykres}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE)
knitr::opts_chunk$set(fig.width=8, fig.height=5) 

library("tidyverse")
library("vcd")
library("ggplot2")
library("knitr")
library("dplyr")
library("xtable")
library("kableExtra")
library("ggplot2")
library('likert')
library("binom")
```


# Część I

## Tablice liczności dla zmiennej A1

```{r}
personel <- read.csv2(file = "personel.csv", header=FALSE)
names(personel) <- c("D", "S", "A1", "A2", "W1", "W2", "P", "Wiek", "Wyk")
personel$A2[personel$A2 == '11'] = '1'
personel <- personel %>% mutate(across(D:Wyk, as.factor))
```


```{r}
tabA1 <- personel %>% count(A1) %>% mutate(prop=n/sum(n))

tabA1wyk1 <- personel %>% filter(Wyk=="1") %>% count(A1) %>% mutate(prop=n/sum(n))
tabA1wyk2 <- personel %>% filter(Wyk=="2") %>% count(A1) %>% mutate(prop=n/sum(n))
tabA1wyk3 <- personel %>% filter(Wyk=="3") %>% count(A1) %>% mutate(prop=n/sum(n))

tabA1Dz <- personel %>% filter(D=="Z") %>% count(A1) %>% mutate(prop=n/sum(n))
tabA1Dp <- personel %>% filter(D=="P") %>% count(A1) %>% mutate(prop=n/sum(n))
tabA1Ds <- personel %>% filter(D=="S") %>% count(A1) %>% mutate(prop=n/sum(n))
tabA1Do <- personel %>% filter(D=="O") %>% count(A1) %>% mutate(prop=n/sum(n))

tabA1Pk <- personel %>% filter(P=="K") %>% count(A1) %>% mutate(prop=n/sum(n))
tabA1Pm <- personel %>% filter(P=="M") %>% count(A1) %>% mutate(prop=n/sum(n))

```


```{r, results='asis'}
t <- kable(tabA1, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)

t1 <- kable(tabA1wyk1, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)

t2 <- kable(tabA1wyk2, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)

t3 <- kable(tabA1wyk3, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)

t4 <- kable(tabA1Dz, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)

t5 <- kable(tabA1Dp, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)

t6 <- kable(tabA1Ds, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)

t7 <- kable(tabA1Do, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)

t8 <- kable(tabA1Pk, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)

t9 <- kable(tabA1Pm, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)


cat(c("\\begin{table}[H]
    \\begin{minipage}{.5\\linewidth}",
      t,
    "\\centering",
    "\\caption{Tablica liczności dla A1.}
      \\centering",
    "\\end{minipage}%
    \\begin{minipage}{.5\\linewidth}",
      t1,
    "\\centering",
    "\\caption{Tablica liczności dla A1 ze względu na Wyk=1.}
      \\centering",
    "\\end{minipage}
\\end{table}"
))

cat(c("\\begin{table}[H]
    \\begin{minipage}{.5\\linewidth}",
      t2,
    "\\centering",
    "\\caption{Tablica liczności dla A1 ze względu na Wyk=2.}",
    "\\end{minipage}%
    \\begin{minipage}{.5\\linewidth}",
      t3,
    "\\centering",
    "\\caption{Tablica liczności dla A1 ze względu na Wyk=3.}
      \\centering",
    "\\end{minipage}
\\end{table}"
))  

cat(c("\\begin{table}[H]
    \\begin{minipage}{.5\\linewidth}",
      t4,
    "\\centering",
    "\\caption{Tablica liczności dla A1 ze względu na D=Z.}",
    "\\end{minipage}%
    \\begin{minipage}{.5\\linewidth}",
      t5,
    "\\centering",
    "\\caption{Tablica liczności dla A1 ze względu na D=P.}
      \\centering",
    "\\end{minipage}
\\end{table}"
)) 

cat(c("\\begin{table}[H]
    \\begin{minipage}{.5\\linewidth}",
      t6,
    "\\centering",
    "\\caption{Tablica liczności dla A1 ze względu na D=S.}",
    "\\end{minipage}%
    \\begin{minipage}{.5\\linewidth}",
      t7,
    "\\centering",
    "\\caption{Tablica liczności dla A1 ze względu na D=O.}
      \\centering",
    "\\end{minipage}
\\end{table}"
)) 

cat(c("\\begin{table}[H]
    \\begin{minipage}{.5\\linewidth}",
      t8,
    "\\centering",
    "\\caption{Tablica liczności dla A1 ze względu na P=k.}",
    "\\end{minipage}%
    \\begin{minipage}{.5\\linewidth}",
      t9,
    "\\centering",
    "\\caption{Tablica liczności dla A1 ze względu na P=m.}
      \\centering",
    "\\end{minipage}
\\end{table}"
)) 
```


## Tablice liczności dla zmiennnej W1

```{r}
tabW1 <- personel %>% count(A1) %>% mutate(prop=n/sum(n))

tabW1wyk1 <- personel %>% filter(Wyk=="1") %>% count(A1) %>% mutate(prop=n/sum(n))
tabW1wyk2 <- personel %>% filter(Wyk=="2") %>% count(A1) %>% mutate(prop=n/sum(n))
tabW1wyk3 <- personel %>% filter(Wyk=="3") %>% count(A1) %>% mutate(prop=n/sum(n))

tabW1Dz <- personel %>% filter(D=="Z") %>% count(A1) %>% mutate(prop=n/sum(n))
tabW1Dp <- personel %>% filter(D=="P") %>% count(A1) %>% mutate(prop=n/sum(n))
tabW1Ds <- personel %>% filter(D=="S") %>% count(A1) %>% mutate(prop=n/sum(n))
tabW1Do <- personel %>% filter(D=="O") %>% count(A1) %>% mutate(prop=n/sum(n))

tabW1Pk <- personel %>% filter(P=="K") %>% count(A1) %>% mutate(prop=n/sum(n))
tabW1Pm <- personel %>% filter(P=="M") %>% count(A1) %>% mutate(prop=n/sum(n))
```


```{r, results='asis'}
tW <- kable(tabW1, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)

t1W <- kable(tabW1wyk1, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)

t2W <- kable(tabW1wyk2, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)

t3W <- kable(tabW1wyk3, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)

t4W <- kable(tabW1Dz, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)

t5W <- kable(tabW1Dp, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)

t6W <- kable(tabW1Ds, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)

t7W <- kable(tabW1Do, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)

t8W <- kable(tabW1Pk, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)

t9W <- kable(tabW1Pm, format = "latex", booktabs = TRUE) %>% 
    column_spec(1, border_left = TRUE, border_right = TRUE) %>%
    column_spec(3, border_left = TRUE, border_right = TRUE)


cat(c("\\begin{table}[H]
    \\begin{minipage}{.5\\linewidth}",
      tW,
    "\\centering",
    "\\caption{Tablica liczności dla W1.}
      \\centering",
    "\\end{minipage}%
    \\begin{minipage}{.5\\linewidth}",
      t1W,
    "\\centering",
    "\\caption{Tablica liczności dla W1 ze względu na Wyk=1.}
      \\centering",
    "\\end{minipage}
\\end{table}"
))

cat(c("\\begin{table}[H]
    \\begin{minipage}{.5\\linewidth}",
      t2W,
    "\\centering",
    "\\caption{Tablica liczności dla W1 ze względu na Wyk=2.}",
    "\\end{minipage}%
    \\begin{minipage}{.5\\linewidth}",
      t3W,
    "\\centering",
    "\\caption{Tablica liczności dla W1 ze względu na Wyk=3.}
      \\centering",
    "\\end{minipage}
\\end{table}"
))  

cat(c("\\begin{table}[H]
    \\begin{minipage}{.5\\linewidth}",
      t4W,
    "\\centering",
    "\\caption{Tablica liczności dla W1 ze względu na D=Z.}",
    "\\end{minipage}%
    \\begin{minipage}{.5\\linewidth}",
      t5W,
    "\\centering",
    "\\caption{Tablica liczności dla W1 ze względu na D=P.}
      \\centering",
    "\\end{minipage}
\\end{table}"
)) 

cat(c("\\begin{table}[H]
    \\begin{minipage}{.5\\linewidth}",
      t6W,
    "\\centering",
    "\\caption{Tablica liczności dla W1 ze względu na D=S.}",
    "\\end{minipage}%
    \\begin{minipage}{.5\\linewidth}",
      t7W,
    "\\centering",
    "\\caption{Tablica liczności dla W1 ze względu na D=O.}
      \\centering",
    "\\end{minipage}
\\end{table}"
)) 

cat(c("\\begin{table}[H]
    \\begin{minipage}{.5\\linewidth}",
      t8W,
    "\\centering",
    "\\caption{Tablica liczności dla W1 ze względu na P=k.}",
    "\\end{minipage}%
    \\begin{minipage}{.5\\linewidth}",
      t9W,
    "\\centering",
    "\\caption{Tablica liczności dla W1 ze względu na P=m.}
      \\centering",
    "\\end{minipage}
\\end{table}"
)) 
```


## Tabele wielodzielcze

```{r, echo=TRUE, results='asis'}
kable(structable(W1~P, personel) %>% addmargins(),
      caption="Tabela wielodzielcza uzwlgędniająca zmienną W1 i P.") %>% 
      column_spec(1, border_left = TRUE) %>%
      column_spec(6, border_right = TRUE) %>%
      kable_styling(latex_options = "HOLD_position")
```

```{r, results='asis'}
kable(structable(W1~S, personel) %>% addmargins(), caption="Tabela wielodzielcza uzwlgędniająca zmienną W1 i S.") %>% 
    column_spec(1, border_left = TRUE) %>%
    column_spec(6, border_right = TRUE) %>%
    kable_styling(latex_options = "HOLD_position")
```

```{r, results='asis'}
kable(structable(A1~D, personel) %>% addmargins(), caption="Tabela wielodzielcza uzwlgędniająca zmienną A1 i D.") %>% 
    column_spec(1, border_left = TRUE) %>%
    column_spec(7, border_right = TRUE) %>%
    kable_styling(latex_options = "HOLD_position")
```


## Wykres słupkowy

```{r,echo=FALSE}
personel <- read.csv2('personel.csv',header=FALSE)
names(personel) <- c('D','S','A1','A2','W1','W2','P','Wiek','Wyk')
personel$A2[personel$A2 == '11'] = '1'
personel$D[personel$D == 'O'] = 'Obsługa kadrowo-płacowa'
personel$D[personel$D == 'P'] = 'Produkcja'
personel$D[personel$D == 'Z'] = 'Zaopatrzenia'
personel$D[personel$D == 'S'] = 'Sprzedaż'

personel$S[personel$S == 1] = 'Tak'
personel$S[personel$S == 0] = 'Nie'

personel$A1[personel$A1 == -2] = 'Zdecydowanie się nie zgadzam'
personel$A1[personel$A1 == -1] = 'Nie zgadzam się'
personel$A1[personel$A1 == 0] = 'Trudno powiedzieć'
personel$A1[personel$A1 == 1] = 'Zgadzam się'
personel$A1[personel$A1 == 2] = 'Zdecydowanie się zgadzam'

personel$A2[personel$A2 == -2] = 'Zdecydowanie się nie zgadzam'
personel$A2[personel$A2 == -1] = 'Nie zgadzam się'
personel$A2[personel$A2 == 0] = 'Trudno powiedzieć'
personel$A2[personel$A2 == 1] = 'Zgadzam się'
personel$A2[personel$A2 == 2] = 'Zdecydowanie się zgadzam'

personel$W1[personel$W1 == -2] = 'Zdecydowanie się nie zgadzam'
personel$W1[personel$W1 == -1] = 'Nie zgadzam się'
personel$W1[personel$W1 == 0] = 'Trudno powiedzieć'
personel$W1[personel$W1 == 1] = 'Zgadzam się'
personel$W1[personel$W1 == 2] = 'Zdecydowanie się zgadzam'

personel$W2[personel$W2 == -2] = 'Zdecydowanie się nie zgadzam'
personel$W2[personel$W2 == -1] = 'Nie zgadzam się'
personel$W2[personel$W2 == 0] = 'Trudno powiedzieć'
personel$W2[personel$W2 == 1] = 'Zgadzam się'
personel$W2[personel$W2 == 2] = 'Zdecydowanie się zgadzam'

personel$P[personel$P == 'K'] = 'Kobieta'
personel$P[personel$P == 'M'] = 'Mężczyzna'
names(personel) <- c('D','S','A1','A2','W1','W2','P','Wiek','Wyk')
personel <- personel %>% mutate(across(D:Wyk,as.factor))
```

```{r, echo=TRUE}
daneW1 <- personel %>% count(W1) %>% data.frame()

ggplot(daneW1, aes(x=W1, y=n)) + 
    geom_bar(stat = "identity", fill="hotpink") + 
    ggtitle("Wykres słupkowy dla oceny wykształcenia przed wyjazdem") + 
    xlab('Ocena wynagrodzenia przed wyjazdem') + 
    ylab('ilość')
```

```{r}
daneW2 <- personel %>% count(W2) %>% data.frame()

ggplot(daneW2, aes(x=W2, y=n)) + 
    geom_bar(stat = "identity", fill="hotpink") + 
    ggtitle("Wykres słupkowy dla oceny wykształcenia po wyjeździe") + 
    xlab('Ocena wynagrodzenia po wyjeździe') + 
    ylab('ilość')
```

Jakieś dwa zdanie tak jak mówiła, ale jej nie słuchałam, więc nie wiem.

## Wykres kołowy

```{r, echo=TRUE}
ggplot(daneW1, aes(x="", y=n, fill=W1)) + 
    geom_bar(stat="identity", width=1) + 
    coord_polar("y", start=0) +
    theme_void() +
    scale_fill_brewer(palette="RdPu") + 
    ggtitle("Wykres kołowy dla oceny wynagrodzenia przed wyjazdem")
```

```{r}
 ggplot(daneW2, aes(x="", y=n, fill=W2)) + 
    geom_bar(stat="identity", width=1) + 
    coord_polar("y", start=0) +
    scale_fill_brewer(palette="RdPu") + 
    theme_void() +
    ggtitle("Wykres kołowy dla oceny wynagrodzenia po wyjeździe")
```

## Wykresy mozaikowe

```{r, echo=FALSE}
personel <- read.csv2(file = "personel.csv", header=FALSE)
names(personel) <- c("D", "S", "A1", "A2", "W1", "W2", "P", "Wiek", "Wyk")
personel$A2[personel$A2 == '11'] = '1'
personel <- personel %>% mutate(across(D:Wyk, as.factor))
```

```{r, echo=TRUE}
mosaic(~D+A1, personel,labeling = vcd::labeling_border(rot_labels = c(90, 90)))
```
```{r}
mosaic(~D+W1, personel)
```
```{r}
mosaic(~S+P, personel)
```
```{r}
mosaic(~P+W1, personel)
```

# Część II

## Funkcja losująca ze zwracaniem i bez

```{r, echo=TRUE}
f <- function(x='bez'){
  if (x=='zwracanie'){
    s <- sample(1:nrow(mtcars),3,replace=TRUE)
  } else{
    s <- sample(1:nrow(mtcars),3)
  }
  mtcars[s, ]
}

f('zwracanie')
```
## Funkcja likert

```{r,echo=FALSE}
personel <- read.csv2('personel.csv',header=FALSE)
names(personel) <- c('D','S','A1','A2','W1','W2','P','Wiek','Wyk')
personel$A2[personel$A2 == '11'] = '1'
personel$D[personel$D == 'O'] = 'Obsługa kadrowo-płacowa'
personel$D[personel$D == 'P'] = 'Produkcja'
personel$D[personel$D == 'Z'] = 'Zaopatrzenia'
personel$D[personel$D == 'S'] = 'Sprzedaż'

personel$S[personel$S == 1] = 'Tak'
personel$S[personel$S == 0] = 'Nie'

personel$A1[personel$A1 == -2] = 'Zdecydowanie się nie zgadzam'
personel$A1[personel$A1 == -1] = 'Nie zgadzam się'
personel$A1[personel$A1 == 0] = 'Trudno powiedzieć'
personel$A1[personel$A1 == 1] = 'Zgadzam się'
personel$A1[personel$A1 == 2] = 'Zdecydowanie się zgadzam'

personel$A2[personel$A2 == -2] = 'Zdecydowanie się nie zgadzam'
personel$A2[personel$A2 == -1] = 'Nie zgadzam się'
personel$A2[personel$A2 == 0] = 'Trudno powiedzieć'
personel$A2[personel$A2 == 1] = 'Zgadzam się'
personel$A2[personel$A2 == 2] = 'Zdecydowanie się zgadzam'

personel$W1[personel$W1 == -2] = 'Zdecydowanie się nie zgadzam'
personel$W1[personel$W1 == -1] = 'Nie zgadzam się'
personel$W1[personel$W1 == 0] = 'Trudno powiedzieć'
personel$W1[personel$W1 == 1] = 'Zgadzam się'
personel$W1[personel$W1 == 2] = 'Zdecydowanie się zgadzam'

personel$W2[personel$W2 == -2] = 'Zdecydowanie się nie zgadzam'
personel$W2[personel$W2 == -1] = 'Nie zgadzam się'
personel$W2[personel$W2 == 0] = 'Trudno powiedzieć'
personel$W2[personel$W2 == 1] = 'Zgadzam się'
personel$W2[personel$W2 == 2] = 'Zdecydowanie się zgadzam'

personel$P[personel$P == 'K'] = 'Kobieta'
personel$P[personel$P == 'M'] = 'Mężczyzna'
names(personel) <- c('Dział','S','Atmosfera przed wyjazdem','Atmosfera po wyjeździe','W1','W2','Płeć','Wiek','Wykształcenie')
personel <- personel %>% mutate(across(Dział:Wykształcenie,as.factor))
```

```{r, echo=TRUE}
df <- data.frame(personel$`Atmosfera przed wyjazdem`,personel$`Atmosfera po wyjeździe`)
colnames(df) <- c('Atmosfera przed wyjazdem', 'Atmosfera po wyjeździe') 
likt_atmo <- likert(df)
summary(likt_atmo)
likert.bar.plot(likt_atmo) + guides(fill=guide_legend(nrow=2,byrow=TRUE,title='Odpowiedź')) + theme(axis.text.y=element_text(angle=45,hjust=1)) + 
  ylab("Procent") 

plot(likt_atmo,type='heat') + theme(axis.text.x=element_text(angle=90,hjust=1),axis.text.y=element_text(angle=45,hjust=1)) + guides(fill=guide_legend(title='Odpowiedź'))

likert.density.plot(likt_atmo)
```

## Podgrupa ze względu na dział

```{r, echo=FALSE}
df <- data.frame(personel$`Atmosfera przed wyjazdem`,personel$`Atmosfera po wyjeździe`)
colnames(df) <- c('Atmosfera przed wyjazdem', 'Atmosfera po wyjeździe') 
likt_atmo_gr_D <- likert(df,grouping=personel$Dział)
summary(likt_atmo_gr_D)
likert.bar.plot(likt_atmo_gr_D) + guides(fill=guide_legend(nrow=2,byrow=TRUE,title='Odpowiedź'))+ 
  ylab("Procent") + xlab('Dział')

likert.density.plot(likt_atmo_gr_D,legend='Dział')
```

## Podgrupa ze względu na płeć

```{r, echo=FALSE}
df <- data.frame(personel$`Atmosfera przed wyjazdem`,personel$`Atmosfera po wyjeździe`)
colnames(df) <- c('Atmosfera przed wyjazdem', 'Atmosfera po wyjeździe') 
likt_atmo_gr_P <- likert(df,grouping=personel$Płeć)
summary(likt_atmo_gr_P)

likert.bar.plot(likt_atmo_gr_P) + guides(fill=guide_legend(nrow=2,byrow=TRUE,title='Odpowiedź'))+ 
  ylab("Procent") + xlab('Płeć')

likert.density.plot(likt_atmo_gr_P,legend='Płeć')
```


## Przedział ufności Cloppera-Pearsona

```{r, echo=FALSE}
personel <- read.csv2('personel.csv',header=FALSE)
names(personel) <- c('D','S','A1','A2','W1','W2','P','Wiek','Wyk')
personel$A2[personel$A2 == '11'] = '1'
personel <- personel %>% mutate(across(D:Wyk,as.factor))
```

```{r, echo=TRUE}
p.lower <- function(x, n, a){
  if(x == 0){
    return(0)
  }
  else{
    return(qbeta(a/2,x,n-x+1))
  }
}


p.upper <- function(x, n, a){
  if(x == n){
    return(1)
  }
  else{
    return(qbeta(1-a/2, x+1, n-x))
  }
}


clopper_pearson_ci <- function(x, n=NULL, a=0.05){
  if(is.null(n)){
    n <- length(x)
    x <- sum(x==1)
    return(c(p.lower(x, n, a), p.upper(x, n, a)))
  }
  else{
    return(c(p.lower(x, n, a), p.upper(x, n, a)))
  }
}

clopper_pearson_ci2 <- function(x, n=NULL, a=0.05){
  if(is.null(n)){
    n <- length(x)
    x <- sum(x==1)
    return(data.frame(x=x, n=n, lower=p.lower(x, n, a), upper=p.upper(x, n, a)))
  }
  else{
    return(data.frame(x=x, n=n, lower=p.lower(x, n, a), upper=p.upper(x, n, a)))
  }
}
```
### Przykład użycia

- funkcja wbudowana
```{r}
x <- rbinom(1, 20, 0.4)
binom.confint(x, 20, methods='exact')
```

- funkcja `clopper_pearcon_ci`
```{r}
clopper_pearson_ci2(x, 20)
```
### Zadowolenie z wynagrodzenia w całej badanej grupie
```{r}
n <- length(personel$W1)
Y <- sum(personel$W1 == 2, personel$W1 == 1)
```

- funkcja `clopper_pearson_ci`
```{r}
clopper_pearson_ci2(Y, n)
```

- funkcja wbudowana
```{r}
binom.confint(Y, n, method="exact")
```


### Zadowolenie z wynagrodzenia ze względu na dział
```{r}
D <- personel %>% group_by(D) %>% 
      summarise(x = sum(W1 == 1, W1 == 2),
                all = sum(W1 == 1, W1 == 2, W1 == -1, W1 == -2))
```

- funkcja `clopper_pearson_ci`
```{r}
dfD <- setNames(data.frame(matrix(ncol = 4, nrow = 0)), c("x", "n", "lower", "upper"))

for(i in 1:length(D$x)){
  dfD <- rbind(dfD, clopper_pearson_ci2(D$x[i], D$all[i]))
}

dfD
```


- funkcja wbudowana
```{r}
binom.confint(D$x, D$all, method="exact")
```


### Zadowolenie z wynagrodzenia ze względu na stanowisko
```{r}
S <- personel %>% group_by(S) %>% 
      summarise(x = sum(W1 == 1, W1 == 2),
                all = sum(W1 == 1, W1 == 2, W1 == -1, W1 == -2))
```

- funkcja `clopper_pearson_ci`
```{r}
dfS <- setNames(data.frame(matrix(ncol = 4, nrow = 0)), c("x", "n", "lower", "upper"))

for(i in 1:length(S$x)){
  dfS <- rbind(dfS, clopper_pearson_ci2(S$x[i], S$all[i]))
}

dfS
```

- funkcja wbudowana
```{r}
binom.confint(S$x, S$all, method="exact")
```


# Część III

## Generowanie rozkładu dwumianowego

### Algorytm
1. Ustal $n$ i $p$.
2. Generuj $Y_i$ z rozkładu $P(Y_i=1) = p = 1 - P(Y_i=0)$.
3. Powtórz krok 2. $n$ razy.
4. Wstaw $X=\sum_{i=1}^{n}{Y_i}$.
5. Powtórz kroki 2-4 $N$ razy.

```{r, echo=TRUE}
generuj_dwumianowy <- function(n, p, N){
  X <- rep(NA, N)
  for(i in 1:N){
    Y <- rep(NA, n)
    for(j in 1:n){
      Y[j] <- sample(c(0,1), size=1, prob=c(1-p,p))
    }
    X[i] <- sum(Y)
  }
  return(X)
}
```

### Porównanie funkcji

```{r, results = 'asis'}
x1 <- rbinom(1000, 20, 0.6)
x2 <- generuj_dwumianowy(20, 0.6, 1000)

df <- data.frame('funkcja'=c('rbinom', 'generuj_dwumianowy'),
      'średnia'= c(mean(x1), mean(x2)),
      'wariancja'=c(var(x1), var(x2)))

kable(df, caption = 'Wartości statystyk', format='markdown')
```
```{r}
df_x1 <- data.frame('x'=x1)
df_x2 <- data.frame('x'=x2)

x<- 1:20
df <- data.frame('x'= x, 'fun'= dbinom(x,20,0.6))

ggplot() + 
  geom_histogram(data = df_x1, aes(x = x, y = ..density..), fill='hotpink', binwidth=1) + 
  labs(title = 'Histogram dla próby otrzymanej przy pomocy funkcji wbudowanej')+
  geom_point(data=df, mapping=aes(x,fun))

```
```{r}
ggplot(data = df_x2, aes(x = x)) + 
  geom_histogram(aes(y = ..density..), fill='hotpink', binwidth=1) + 
  labs(title = 'Histogram dla próby otrzymanej przy pomocy funkcji generuj_dwumianowy')
```

## Prawdopodobieństwo pokrycia

### Opis symulacji

Coś, że Monte Carlo itp.

### Algorytm
1. Ustal $n$ i $p$.
2. Generuj realizację zmiennej losowej z rozkładu $\mathcal{B}(n,p)$.
3. Wyznacz przedział ufności dla parametru $p$ wybraną metodą.
4. Sprzwdź czy $p \in$ przedziału ufności. Wyznacz długość przedziału.
5. Powtórz 2-4 $N$ razy.
6. Wyznacz procent pokrycia i średnią długość przedziału.


```{r, echo=TRUE}
simulation <- function(n, method, name){
  N <- 1000
  p <- seq(0, 1, 0.01)
  for(j in 1:length(p)){
    len <- rep(NA, N)
    counter <- 0
      for(i in 1:N){
        x <- rbinom(1, n, p[j])
        interval <- binom.confint(x, n, conf.level = 0.95, methods = method)
        TL <- interval$lower
        TU <- interval$upper
        if(between(p[j], TL, TU)){
          counter <- counter + 1
        }
        len[i] <- TU - TL
      }
      p.cover <- counter/N
      p.len <- mean(len)
      df <- data.frame('p' = p[j], 'pokrycie' = p.cover, 'dlugosc' = p.len)
      write.table(df, name, 
          append = TRUE,
          sep = ",",
          col.names = FALSE,
          row.names = FALSE,
          quote = FALSE)
  }
  }
```

```{r}
cp30 <- read.csv('cpn30.csv', col.names = c('p', 'pokrycie', 'len'))
w30 <- read.csv('wald_n30.csv', col.names = c('p', 'pokrycie', 'len'))
b30 <- read.csv('bayes_n30.csv', col.names = c('p', 'pokrycie', 'len'))

cp100 <- read.csv('cpn100.csv', col.names = c('p', 'pokrycie', 'len'))
w100 <- read.csv('wald_n100.csv', col.names = c('p', 'pokrycie', 'len'))
b100 <- read.csv('bayes_n100.csv', col.names = c('p', 'pokrycie', 'len'))

cp1000 <- read.csv('cpn1000.csv', col.names = c('p', 'pokrycie', 'len'))
w1000 <- read.csv('wald_n1000.csv', col.names = c('p', 'pokrycie', 'len'))
b1000 <- read.csv('bayes_n1000.csv', col.names = c('p', 'pokrycie', 'len'))

```

```{r}
ggplot() + geom_line(aes(x=cp30$p, y=cp30$pokrycie, color='Cloppera-Pearsona')) + 
  geom_line(aes(x=w30$p, y=w30$pokrycie, color='Walda')) +
  geom_line(aes(x=b30$p, y=b30$pokrycie,color='Bayesa')) +
  labs(title = 'Procent pokrycia dla n = 30', y ='% pokrycia', x = 'p') + 
  geom_hline(yintercept = 0.95, linetype = 'dashed')+
  scale_colour_manual("Przedział ufności", 
                      breaks = c("Cloppera-Pearsona", "Walda", "Bayesa"),
                      values = c("purple", "hotpink", "darkblue"))
```
```{r}
ggplot() + geom_line(aes(x=cp30$p, y=cp30$len, color='Cloppera-Pearsona')) + 
  geom_line(aes(x=w30$p, y=w30$len, color='Walda')) +
  geom_line(aes(x=b30$p, y=b30$len, color='Bayesa')) +
  labs(title = 'Procent pokrycia dla n = 30', y ='Średnia długość przedziału', x = 'p') + 
  geom_hline(yintercept = 0.95, linetype = 'dashed')+
  scale_colour_manual("Przedział ufności", 
                      breaks = c("Cloppera-Pearsona", "Walda", "Bayesa"),
                      values = c("purple", "hotpink", "darkblue"))
```

```{r}
ggplot() + geom_line(aes(x=cp100$p, y=cp100$pokrycie, color='Cloppera-Pearsona')) + 
  geom_line(aes(x=w100$p, y=w100$pokrycie,color='Walda')) +
  geom_line(aes(x=b100$p, y=b100$pokrycie, color='Bayesa')) +
  labs(title = 'Procent pokrycia dla n = 100', y ='% pokrycia', x = 'p',color = "Przedział ufności") + 
  geom_hline(yintercept = 0.95, linetype = 'dashed')+
  scale_colour_manual("Przedział ufności", 
                      breaks = c("Cloppera-Pearsona", "Walda", "Bayesa"),
                      values = c("purple", "hotpink", "darkblue"))

ggplot() + geom_line(aes(x=cp100$p, y=cp100$len, color='Cloppera-Pearsona')) + 
  geom_line(aes(x=w100$p, y=w100$len, color='Walda')) +
  geom_line(aes(x=b100$p, y=b100$len, color='Bayesa')) +
  labs(title = 'Procent pokrycia dla n = 100', y ='Średnia długość przedziału', x = 'p') + 
  geom_hline(yintercept = 0.95, linetype = 'dashed')+
  scale_colour_manual("Przedział ufności", 
                      breaks = c("Cloppera-Pearsona", "Walda", "Bayesa"),
                      values = c("purple", "hotpink", "darkblue"))
```

```{r}
ggplot() + geom_line(aes(x=cp1000$p, y=cp1000$pokrycie, color='Cloppera-Pearsona')) + 
  geom_line(aes(x=w1000$p, y=w1000$pokrycie, color='Walda')) +
  geom_line(aes(x=b1000$p, y=b1000$pokrycie, color='Bayesa')) +
  labs(title = 'Procent pokrycia dla n = 1000', y ='% pokrycia', x = 'p') + 
  geom_hline(yintercept = 0.95, linetype = 'dashed') +
  scale_colour_manual("Przedział ufności", 
                      breaks = c("Cloppera-Pearsona", "Walda", "Bayesa"),
                      values = c("purple", "hotpink", "darkblue"))

ggplot() + geom_line(aes(x=cp1000$p, y=cp1000$len, color='Cloppera-Pearsona')) + 
  geom_line(aes(x=w1000$p, y=w1000$len, color='Walda')) +
  geom_line(aes(x=b1000$p, y=b1000$len,color='Bayesa')) +
  labs(title = 'Procent pokrycia dla n = 1000', y ='Średnia długość przedziału', x = 'p') + 
  geom_hline(yintercept = 0.95, linetype = 'dashed')+
  scale_colour_manual("Przedział ufności", 
                      breaks = c("Cloppera-Pearsona", "Walda", "Bayesa"),
                      values = c("purple", "hotpink", "darkblue"))
```


